def calculate_w_l_s():
	if Sensor.isActive():
		l = 0;
		m = 0;
		n = 0;
		p = 0;
		q = 0;
		w;
		calibrations = allForSensorInLastFourDays() # 5 days was a bit much, dropped this to 4
		if (calibrations.size() == 1):
			Calibration calibration = Calibration.last();
			calibration.slope = 1;
			calibration.intercept = calibration.bg - (calibration.raw_value * calibration.slope);
			calibration.save();
		else:
			for (Calibration calibration : calibrations) {
			w = calibration.calculateWeight();
			l += (w);
			m += (w * calibration.estimate_raw_at_time_of_calibration);
			n += (w * calibration.estimate_raw_at_time_of_calibration * calibration.estimate_raw_at_time_of_calibration);
			p += (w * calibration.bg);
			q += (w * calibration.estimate_raw_at_time_of_calibration * calibration.bg);

		Calibration last_calibration = Calibration.last();
		w = (last_calibration.calculateWeight() * (calibrations.size() * 0.14));
		l += (w);
		m += (w * last_calibration.estimate_raw_at_time_of_calibration);
		n += (w * last_calibration.estimate_raw_at_time_of_calibration * last_calibration.estimate_raw_at_time_of_calibration);
		p += (w * last_calibration.bg);
		q += (w * last_calibration.estimate_raw_at_time_of_calibration * last_calibration.bg);

		double d = (l * n) - (m * m);
		Calibration calibration = Calibration.last();
		calibration.intercept = ((n * p) - (m * q)) / d;
		calibration.slope = ((l * q) - (m * p)) / d;

		# TODO Denke hier ist einer der interessantesten Teile der Software.

		if ((calibrations.size() == 2 && calibration.slope < 0.95) || (calibration.slope < 0.85)): 
			# I have not seen a case where a value below 7.5 proved to be accurate but we should keep an eye on this
			calibration.slope = calibration.slopeOOBHandler(0);
			if(calibrations.size() > 2) { calibration.possible_bad = true; }
			calibration.intercept = calibration.bg - (calibration.estimate_raw_at_time_of_calibration * calibration.slope);
			CalibrationRequest.createOffset(calibration.bg, 25);
			
		if ((calibrations.size() == 2 && calibration.slope > 1.3) || (calibration.slope > 1.4)):
			calibration.slope = calibration.slopeOOBHandler(1);
			if(calibrations.size() > 2) { calibration.possible_bad = true; }
			calibration.intercept = calibration.bg - (calibration.estimate_raw_at_time_of_calibration * calibration.slope);
			CalibrationRequest.createOffset(calibration.bg, 25);
		
		Log.d(TAG, "Calculated Calibration Slope: " + calibration.slope);
		Log.d(TAG, "Calculated Calibration intercept: " + calibration.intercept);
		calibration.save();
		}
	else:
		Log.d(TAG, "NO Current active sensor found!!");
